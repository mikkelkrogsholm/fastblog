<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Last Christmas I gave you my heart | Mikkel’s Data Science Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Last Christmas I gave you my heart" />
<meta name="author" content="Mikkel Freltoft Krogsholm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="TLDR; There is no such thing as a summer classic - but plenty of christmas classics!" />
<meta property="og:description" content="TLDR; There is no such thing as a summer classic - but plenty of christmas classics!" />
<link rel="canonical" href="https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html" />
<meta property="og:url" content="https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html" />
<meta property="og:site_name" content="Mikkel’s Data Science Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-05T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Mikkel Freltoft Krogsholm"},"description":"TLDR; There is no such thing as a summer classic - but plenty of christmas classics!","@type":"BlogPosting","headline":"Last Christmas I gave you my heart","dateModified":"2020-08-05T00:00:00-05:00","datePublished":"2020-08-05T00:00:00-05:00","url":"https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/fastblog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://mikkelkrogsholm.github.io/fastblog/feed.xml" title="Mikkel's Data Science Blog" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-16234539-10','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/fastblog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Last Christmas I gave you my heart | Mikkel’s Data Science Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Last Christmas I gave you my heart" />
<meta name="author" content="Mikkel Freltoft Krogsholm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="TLDR; There is no such thing as a summer classic - but plenty of christmas classics!" />
<meta property="og:description" content="TLDR; There is no such thing as a summer classic - but plenty of christmas classics!" />
<link rel="canonical" href="https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html" />
<meta property="og:url" content="https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html" />
<meta property="og:site_name" content="Mikkel’s Data Science Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-05T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Mikkel Freltoft Krogsholm"},"description":"TLDR; There is no such thing as a summer classic - but plenty of christmas classics!","@type":"BlogPosting","headline":"Last Christmas I gave you my heart","dateModified":"2020-08-05T00:00:00-05:00","datePublished":"2020-08-05T00:00:00-05:00","url":"https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://mikkelkrogsholm.github.io/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://mikkelkrogsholm.github.io/fastblog/feed.xml" title="Mikkel's Data Science Blog" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-16234539-10','auto');ga('require','displayfeatures');ga('send','pageview');</script>



<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/fastblog/">Mikkel&#39;s Data Science Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/fastblog/about/">About Me</a><a class="page-link" href="/fastblog/contact/">Contact</a><a class="page-link" href="/fastblog/search/">Search</a><a class="page-link" href="/fastblog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Last Christmas I gave you my heart</h1><p class="page-description">TLDR; There is no such thing as a summer classic - but plenty of christmas classics!</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-05T00:00:00-05:00" itemprop="datePublished">
        Aug 5, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Mikkel Freltoft Krogsholm</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/fastblog/categories/#spotify">spotify</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#charts">charts</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#christmas">christmas</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#summer">summer</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#R">R</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#jupyter">jupyter</a>
        
      
      </p>
    

    
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h3"><a href="#Setup">Setup </a></li>
<li class="toc-entry toc-h3"><a href="#Collect-the-data">Collect the data </a></li>
<li class="toc-entry toc-h3"><a href="#Visualize-the-data">Visualize the data </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Year-on-year-repeaters">Year on year repeaters </a></li>
<li class="toc-entry toc-h4"><a href="#Christmas-repeaters">Christmas repeaters </a></li>
<li class="toc-entry toc-h4"><a href="#Plotted-together">Plotted together </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Interpretation">Interpretation </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Non-Christmas">Non Christmas </a></li>
<li class="toc-entry toc-h4"><a href="#Christmas">Christmas </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Conlusion">Conlusion </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-08-05-last_christmas.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This blogpost looks at music.</p>
<p>I have downloaded most of the chart data from <a href="https://spotifycharts.com/">spotifycharts</a> and stored them in a SQLite database.</p>
<p>Specifically I will look at "seasonal classics". It turns out that there are no summer classics - only christmas classics. It looks like Summer Hits are temporary and fleeing where Christmas songs are more permanent.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setup">
<a class="anchor" href="#Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup<a class="anchor-link" href="#Setup"> </a>
</h3>
<p>First I load the needed libraries and created a connection to my local database with music.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">suppressPackageStartupMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">))</span>
<span class="n">library</span><span class="p">(</span><span class="n">RSQLite</span><span class="p">)</span>

<span class="n">options</span><span class="p">(</span><span class="nb">repr</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="nb">repr</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">height</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">scipen</span> <span class="o">=</span> <span class="mi">999</span><span class="p">)</span>

<span class="n">con</span> <span class="o">&lt;-</span> <span class="n">dbConnect</span><span class="p">(</span><span class="n">RSQLite</span><span class="p">::</span><span class="n">SQLite</span><span class="p">(),</span> <span class="s2">"spotify.db"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Collect-the-data">
<a class="anchor" href="#Collect-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Collect the data<a class="anchor-link" href="#Collect-the-data"> </a>
</h3>
<p>I will look a three countries: Germany (de), Denmark (dk) and Great Britain (gb). And then create a plot that shows how many Christmas songs are the same year on year, but summer songs are not.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Make a reference to the table in the DB</span>
<span class="n">tblref</span> <span class="o">&lt;-</span> <span class="n">tbl</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="s2">"top200"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Collect the data</span>
<span class="n">dfhere</span> <span class="o">&lt;-</span> <span class="n">tblref</span> <span class="o">%&gt;%</span>
    <span class="nb">filter</span><span class="p">(</span><span class="n">region</span> <span class="o">%</span><span class="k">in</span>% c("de", "dk", "gb")) %&gt;% # filter relevant countries
    <span class="n">mutate</span><span class="p">(</span><span class="n">m</span> <span class="o">=</span> <span class="n">str_sub</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="c1"># create a month column</span>
           <span class="n">y</span> <span class="o">=</span> <span class="n">str_sub</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="c1"># create a year column</span>
           <span class="n">ym</span> <span class="o">=</span> <span class="n">paste</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="c1"># create a yearmonth  column</span>
    <span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="err">`</span><span class="n">Track</span> <span class="n">Name</span><span class="err">`</span><span class="p">,</span> <span class="n">Artist</span><span class="p">,</span> <span class="n">URL</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># Group by region, track and year month</span>
    <span class="n">summarise</span><span class="p">(</span><span class="n">streams</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Streams</span><span class="p">,</span> <span class="n">na</span><span class="o">.</span><span class="n">rm</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="c1"># sum up the streams for a track per year month </span>
    <span class="n">ungroup</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="c1"># ungroup</span>
    <span class="n">collect</span><span class="p">()</span> <span class="c1"># Import the data into R's memory</span>

<span class="c1"># Lets have a look at the first few lines</span>
<span class="n">head</span><span class="p">(</span><span class="n">dfhere</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With the monthly data now in memory I will pick the top 100 tracks per month</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">top</span> <span class="o">&lt;-</span> <span class="n">dfhere</span> <span class="o">%&gt;%</span>
    <span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">ym</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">top_n</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">streams</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">ungroup</span><span class="p">()</span>

<span class="c1"># yms &lt;- top$ym %&gt;% unique() %&gt;% sort()</span>
<span class="c1"># top$ym &lt;- factor(top$ym, levels = yms)</span>

<span class="n">head</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we need to divide the data into different data frames. We need these to create the visualization.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># First I create a table with repeaters, i.e. with songs that appear in the same month across the years more than once:</span>
<span class="n">repeaters</span> <span class="o">&lt;-</span> <span class="n">top</span> <span class="o">%&gt;%</span>
    <span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">count</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="err">`</span><span class="n">Track</span> <span class="n">Name</span><span class="err">`</span><span class="p">,</span> <span class="n">Artist</span><span class="p">,</span> <span class="n">URL</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nb">filter</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">select</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">URL</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">ungroup</span><span class="p">()</span>

<span class="c1"># Then I filter the data to only contain data for the repeathers</span>
<span class="n">toprep</span> <span class="o">&lt;-</span> <span class="n">top</span> <span class="o">%&gt;%</span>
    <span class="n">inner_join</span><span class="p">(</span><span class="n">repeaters</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"region"</span><span class="p">,</span> <span class="s2">"URL"</span><span class="p">))</span>

<span class="c1"># Then I create a table with the songs that have max hits in december</span>
<span class="n">xmasmax</span> <span class="o">&lt;-</span> <span class="n">toprep</span> <span class="o">%&gt;%</span>
    <span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">URL</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nb">filter</span><span class="p">(</span><span class="n">streams</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">streams</span><span class="p">),</span>
           <span class="n">m</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">select</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">URL</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="n">ungroup</span><span class="p">()</span>

<span class="c1"># And use this table to create a data frame for repeater songs where</span>
<span class="c1"># the most streams are not in december</span>
<span class="n">noxmas</span> <span class="o">&lt;-</span> <span class="n">toprep</span> <span class="o">%&gt;%</span> <span class="n">anti_join</span><span class="p">(</span><span class="n">xmasmax</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"region"</span><span class="p">,</span> <span class="s2">"URL"</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">distinct</span><span class="p">()</span>

<span class="c1"># And a dataframe where most streams are in december</span>
<span class="n">xmas</span> <span class="o">&lt;-</span> <span class="n">toprep</span> <span class="o">%&gt;%</span> <span class="n">inner_join</span><span class="p">(</span><span class="n">xmasmax</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"region"</span><span class="p">,</span> <span class="s2">"URL"</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">distinct</span><span class="p">()</span>

<span class="n">head</span><span class="p">(</span><span class="n">xmas</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Visualize-the-data">
<a class="anchor" href="#Visualize-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Visualize the data<a class="anchor-link" href="#Visualize-the-data"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Year-on-year-repeaters">
<a class="anchor" href="#Year-on-year-repeaters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Year on year repeaters<a class="anchor-link" href="#Year-on-year-repeaters"> </a>
</h4>
<p>Let's first look at the songs that repeat year on year. As you can see the songs normally have a more or less sharp rise and then a long slow decline. It is this decline that makes it possible for the song to appear in the same months year on year, although on a very different scale.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># I need a little helper to create pretty x-axis on the charts</span>
<span class="n">yms</span> <span class="o">&lt;-</span> <span class="n">top</span><span class="err">$</span><span class="n">ym</span> <span class="o">%&gt;%</span> <span class="n">unique</span><span class="p">()</span> <span class="o">%&gt;%</span> <span class="n">sort</span><span class="p">()</span>
<span class="n">yms_labs</span> <span class="o">&lt;-</span> <span class="n">str_c</span><span class="p">(</span><span class="n">str_sub</span><span class="p">(</span><span class="n">yms</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s2">" '"</span><span class="p">,</span> <span class="n">str_sub</span><span class="p">(</span><span class="n">yms</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">yms_df</span> <span class="o">&lt;-</span> <span class="n">top</span> <span class="o">%&gt;%</span> <span class="n">distinct</span><span class="p">(</span><span class="n">ym</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span> 
    <span class="c1"># Then I plot the non-xmas data in green</span>
    <span class="n">geom_line</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">noxmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"darkgreen"</span><span class="p">,</span> 
              <span class="n">linetype</span> <span class="o">=</span> <span class="s2">"dashed"</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">noxmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"darkgreen"</span><span class="p">,</span> 
               <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> 
    
    <span class="c1"># And some chart styling</span>
    <span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">yms_labs</span><span class="p">,</span> <span class="n">limits</span> <span class="o">=</span> <span class="n">yms</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">theme_minimal</span><span class="p">()</span> <span class="o">+</span> 
    <span class="n">theme</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">45</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">facet_wrap</span><span class="p">(</span><span class="n">facets</span> <span class="o">=</span> <span class="o">~</span> <span class="n">region</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scales</span> <span class="o">=</span> <span class="s2">"free_y"</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">"Streams per month"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Christmas-repeaters">
<a class="anchor" href="#Christmas-repeaters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Christmas repeaters<a class="anchor-link" href="#Christmas-repeaters"> </a>
</h4>
<p>It looks a bit different if we plot the Christmas songs. It becomes very obvious that the Christmas repeaters are limited to Christmas. They also do not follow the same path as the other songs (sharp increase, long slow decrease). They come to life pretty high on the charts in december (some in november) and then they quickly die out and wait for Christmas to come again. I have marked decemberr with a red dashed line.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span> 

    <span class="c1"># First I create a vertical red dashed line for every december month</span>
    <span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"2017 12"</span><span class="p">,</span> <span class="s2">"2018 12"</span><span class="p">,</span> <span class="s2">"2019 12"</span><span class="p">),</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s2">"dashed"</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"red"</span><span class="p">)</span> <span class="o">+</span>
    
    <span class="c1"># And the christmas data in blue</span>
    <span class="n">geom_line</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">xmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"blue"</span><span class="p">,</span> 
              <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">xmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"blue"</span><span class="p">,</span> 
               <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> 
    
    <span class="c1"># And some chart styling</span>
    <span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">yms_labs</span><span class="p">,</span> <span class="n">limits</span> <span class="o">=</span> <span class="n">yms</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">theme_minimal</span><span class="p">()</span> <span class="o">+</span> 
    <span class="n">theme</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">45</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">facet_wrap</span><span class="p">(</span><span class="n">facets</span> <span class="o">=</span> <span class="o">~</span> <span class="n">region</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scales</span> <span class="o">=</span> <span class="s2">"free_y"</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">"Streams per month"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Plotted-together">
<a class="anchor" href="#Plotted-together" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plotted together<a class="anchor-link" href="#Plotted-together"> </a>
</h4>
<p>When plotted together the difference becomes obvious.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span> 
    <span class="c1"># First I create a vertical red dashed line for every december month</span>
    <span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"2017 12"</span><span class="p">,</span> <span class="s2">"2018 12"</span><span class="p">,</span> <span class="s2">"2019 12"</span><span class="p">),</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s2">"dashed"</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"red"</span><span class="p">)</span> <span class="o">+</span>
    
    <span class="c1"># Then I plot the non-xmas data in green</span>
    <span class="n">geom_line</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">noxmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"darkgreen"</span><span class="p">,</span> 
              <span class="n">linetype</span> <span class="o">=</span> <span class="s2">"dashed"</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">noxmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"darkgreen"</span><span class="p">,</span> 
               <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> 
    
    <span class="c1"># And the christmas data in blue</span>
    <span class="n">geom_line</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">xmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"blue"</span><span class="p">,</span> 
              <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">xmas</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">ym</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">URL</span><span class="p">),</span> <span class="n">show</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">"blue"</span><span class="p">,</span> 
               <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> 
    
    <span class="c1"># And some chart styling</span>
    <span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">yms_labs</span><span class="p">,</span> <span class="n">limits</span> <span class="o">=</span> <span class="n">yms</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">theme_minimal</span><span class="p">()</span> <span class="o">+</span> 
    <span class="n">theme</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">45</span><span class="p">))</span> <span class="o">+</span>
    <span class="n">facet_wrap</span><span class="p">(</span><span class="n">facets</span> <span class="o">=</span> <span class="o">~</span> <span class="n">region</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">scales</span> <span class="o">=</span> <span class="s2">"free_y"</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">"Streams per month"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Interpretation">
<a class="anchor" href="#Interpretation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interpretation<a class="anchor-link" href="#Interpretation"> </a>
</h3>
<h4 id="Non-Christmas">
<a class="anchor" href="#Non-Christmas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Non Christmas<a class="anchor-link" href="#Non-Christmas"> </a>
</h4>
<p>We see a few non-christmas songs that make it more than a year - ie they appear in the same month i more than one year. But, they show a much different trend than the christmas songs. They have a pattern of popularity and then a fade out.</p>
<h4 id="Christmas">
<a class="anchor" href="#Christmas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Christmas<a class="anchor-link" href="#Christmas"> </a>
</h4>
<p>With the Christmas songs we see a whole different pattern. First we see more of them, ie there are more survivors year on year. Second the pattern is quite different; the songs lie dormant pretty much all year and then suddenly they explode in december. Some even get an early listen in november, where the must christmas enthusiastic people get started.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conlusion">
<a class="anchor" href="#Conlusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conlusion<a class="anchor-link" href="#Conlusion"> </a>
</h2>
<p>There is no such thing as a summer classic - but plenty of christmas classics!</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="mikkelkrogsholm/fastblog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/fastblog/spotify/charts/christmas/summer/r/jupyter/2020/08/05/last_christmas.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fastblog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/fastblog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/fastblog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A blog journaling my adventures into data science</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/mikkelkrogsholm" title="mikkelkrogsholm"><svg class="svg-icon grey"><use xlink:href="/fastblog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/mikkelkrogsholm" title="mikkelkrogsholm"><svg class="svg-icon grey"><use xlink:href="/fastblog/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/mikkelkrogsholm" title="mikkelkrogsholm"><svg class="svg-icon grey"><use xlink:href="/fastblog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
